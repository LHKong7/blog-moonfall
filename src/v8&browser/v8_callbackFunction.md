# Callback Function 什么是回调函数
回调函数与普通函数的特性一样，有着参数与返回值，区别在于调用方式不同，只有当某个函数被作为参数，传递给**另一个函数**，或者传递给**宿主环境**，然后该函数放在函数内部或者宿主环境中被调用，我们才称为回调函数。

回调函数有着两种不同的形式：
- 同步回调： 在执行函数内部被执行的
- 异步回调： 异步回调函数是在执行函数外部被执行的。

同步回调：`Array.forEach`中的回调函数，执行时机则是会在执行函数内部被执行。
异步回调： 
```js
function foo() {
    alert("Hello");
}
setTimeout(foo, 3000)
```
foo 函数才会被 V8 调用，foo 函数并不是在 setTimeout 函数内部被执行的，所以这是一个异步回调。

#### UI线程与异步函数执行关系
UI线程的宏观架构：早期浏览器的页面是运行在一个单独的 UI 线程中的，所以要在页面中引入 JavaScript，那么 JavaScript 也必须要运行在和页面相同的线程上，这样才能方便使用 JavaScript 来操纵 DOM，所以从一开始，JavaScript 就被设计成了运行在 UI 线程中。

UI 线程，是指运行窗口的线程，当你运行一个窗口时，无论该页面是 Windows 上的窗口系统，还是 Android 或者 iOS 上的窗口系统，它们都需要处理各种事件，诸如有触发绘制页面的事件，有鼠标点击、拖拽、放大缩小的事件，有资源下载、文件读写的事件，等等。
在页面线程中，当一个事件被触发时，比如用户使用鼠标点击了页面，系统需要将该事件提交给 UI 线程来处理。
在大部分情况下，UI 线程并不能立即响应和处理这些事件，比如在你在移动鼠标的过程中，每移动一个像素都会产生一个事件，所以鼠标移动的事件会频繁地被触发。在这种情况下，页面线程可能正在处理前一个事件，那么最新的事件就无法被立即执行。

针对这种情况，**我们为 UI 线程提供一个消息队列**，并将这些待执行的事件添加到消息队列中，然后 UI 线程会不断循环地从消息队列中取出事件、执行事件。**我们把 UI 线程每次从消息队列中取出事件，执行事件的过程称为一个任务。**

#### 异步回调的执行时机：
在执行 setTimeout 函数的过程中，宿主就会将 foo 函数封装成一个事件，并添加到消息队列中，然后 setTimeout 函数执行结束。主线程会不间断地从消息队列中取出新的任务，执行新的任务，等到时机合适，便取出 setTimeout 设置的 foo 函数的回调的任务，然后就可以直接执行 foo 函数的调用了。


